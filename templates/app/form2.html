{% extends 'app/base.html' %}
{% load static %}
{% block content%}

<div class="container" style="margin-top: 10px;">
    <h1>{{title}}</h1>
    <form method="post" style="margin-bottom: 3rem;">
        {% csrf_token %}
        <!-- Hidden -->    {{form.nationality}}{{form.partner}}{{ form.date }}
        <div class="form-row" style="margin-top: 2rem">
            {% for field in form %}
                {% if forloop.counter <= 9 %}
                    <div class="form-group col-md-2">{{ field.label_tag}}{{field}}</div>
                {%endif%}
            {% endfor %}
            <div class="form-group col-md-2">{{ partner_choice }}</div>
            <div class="form-group col-md-2">{{ form.invitation_number.label_tag}}{{form.invitation_number}}</div>
        </div>

        <div class="form-row" style="margin-bottom:2rem;">
            <div class="form-group col-md-2">{{ship_choice}}</div>
            <div id="date_choice_div_id" class="form-group col-md-2">{{date_choice}}</div>
            <div class="form-group col-md-2">{{ form.entry.label_tag}}{{form.entry}}</div>
            <div class="form-group col-md-2">{{ form.departure.label_tag}}{{form.departure}}</div>
            <div class="form-group col-md-2">{{ nationality_choice }}</div>
        </div>

        <div class="form-row">
            <div class="form-group col-md-10">{{ form.label_tag.placement }}{{ form.placement }}</div>
            <div class="form-group col-md-2">{{ placement_choice }}</div>
            <div class="form-group col-md-10">{{ form.label_tag.rout }}{{ form.rout }}</div>
            <div class="form-group col-md-2">{{ rout_choice }}</div>
            <div class="form-group col-md-10">{{ form.label_tag.hostorganization }}{{ form.hostorganization }}</div>
            <div class="form-group col-md-2">{{ organization_choice }}</div>
            <div class="form-group col-md-10">{{ form.label_tag.additionalinfo}}{{ form.additionalinfo }}</div>
            <div class="form-group col-md-2">{{ info_choice }}</div>
        </div>

        <!-- Save form -->
        <div class="form-row align-items-center">
            <div class="col-auto">
                <button type="submit" class="btn btn-outline-secondary btn-sm">Сохранить</button>
            </div>
        </div>

        <!-- Ниже - код для членов группы при редактировании...-->
        <div style="margin-top: 2rem;">
            {% for m in member_forms %}
            <div id="member_id_{{forloop.counter}}" class="form-row" style="font-size: 85%;">
                {% for field in m %}
                    <div class="" style="">
                        {{field}}
                    </div>
                {% endfor %}
                <button type="button" id="delete_btn_id_{{forloop.counter}}" class="btn btn-outline-secondary btn-sm input-xs" onclick="delete_m({{forloop.counter}})">-</button>
            </div>
            {% endfor %}
        </div>

        <!-- Место для вставки членов группы-->
        <div id="members" style=""></div>

        <input type="hidden" name="NUM" value="1" id="NUM">
        <button type="button" id="add_member" class="btn btn-outline-secondary btn-sm input-xs" onclick="add_m()">+</button>
    </form>
</div>

<script>
    window['csrf_token'] = '{{csrf_token}}'
</script>

<script src="{% static '/js/form-default.js'%}" type="text/javascript"></script>
{% if view != 'edit' %}
    <script src="{% static '/js/form-eval-default.js'%}" type="text/javascript"></script>
{% endif %}
<script>

NUM = {{ NUM }}
var m = document.getElementById('members');
function add_m()
{
    console.log('add_member')
    NUM++;
    $.ajax({
        url: '/add_member',
        type: 'post',
        data: {'NUM':NUM,'csrfmiddlewaretoken': '{{csrf_token}}'},
        success: function(resp)
        {
            //console.log(resp)
            $("#members").append(resp);
            $('#NUM').val(NUM)
        },
    });
}

function delete_m(NUM)
{
    console.log('del')
    $("#member_id_"+NUM).remove()
    $('#NUM').val(NUM)
}
</script>


{% endblock %}

